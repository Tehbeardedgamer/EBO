'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' DECLARE VARIABLE INPUTS, OUTPUTS and PUBLICS
    Numeric Input CHW_PUMP_DOWN, CHW_PUMP_STATUS, CHW_PUMP_LEAD, CHW_PUMP_SPEED_MIN,CHW_DIFF_PRESS_LOW, CHW_DIFF_PRESS_SP
    Numeric Output CHW_PUMP_SS, CHW_PUMP_FAIL, CHW_PUMP_SPEED_CTRL
    Numeric OldError, PK, IK, DK, I_VFD, Pct_VFD,tmr
'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' FUNCTION DECLARATIONS
    Function SecTimer,PidControl

'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' DECLARE INITIALIZATION ROUTINE
    Goto Initialize
'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' INITALIZE ROUTINE
    Initialize:
        PK = 3
        IK = 0.05 
        DK = 0

        Goto PUMP_OFF
'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' START PUMP 
    START_PUMP:
        CHW_PUMP_SS = On
        If (CHW_PUMP_DOWN = On) then Goto PUMP_OFF
        If (CHW_PUMP_STATUS = On) then Goto CONTROL_LOOP
        If SecTimer((CHW_PUMP_STATUS = Off), 300, tmr) then CHW_PUMP_FAIL = On
        If CHW_PUMP_FAIL = On then Goto PUMP_FAIL
'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' CONTROL LOOP
    CONTROL_LOOP:
        If (CHW_PUMP_DOWN = On) then Goto PUMP_OFF
        If (CHW_PUMP_LEAD <> 1) then Goto PUMP_OFF
        If SecTimer((CHW_PUMP_STATUS = Off), 300, tmr) then CHW_PUMP_FAIL = On
        If CHW_PUMP_FAIL = On then Goto PUMP_FAIL
        CHW_PUMP_SS = On
        CHW_PUMP_SPEED_CTRL = PidControl(0, CHW_DIFF_PRESS_LOW, CHW_DIFF_PRESS_SP, I_VFD, PK, IK, DK, OldError, CHW_PUMP_SPEED_MIN, 100, Pct_VFD)
'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' PUMP OFF
    PUMP_OFF:
        If (CHW_PUMP_LEAD = 1) and (CHW_PUMP_DOWN = Off) then Goto START_PUMP
        CHW_PUMP_SS = On
        CHW_PUMP_SPEED_CTRL = 0
        I_VFD = 0
'_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_
' PUMP FAILURE
    PUMP_FAIL:
        If (CHW_PUMP_FAIL = Off) then Goto PUMP_OFF
        CHW_PUMP_SS = On
        CHW_PUMP_SPEED_CTRL = 0
        I_VFD = 0

'End of program 
